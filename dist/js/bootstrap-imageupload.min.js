/**
 * bootstrap-imageupload v1.3.0
 * https://github.com/egonolieux/bootstrap-imageupload
 * Copyright 2016 Egon Olieux
 * Released under the MIT license
 */

if("undefined"==typeof jQuery)throw new Error("bootstrap-imageupload's JavaScript requires jQuery.");!function(e){"use strict";function i(i){v=e.extend({},e.fn.imageupload.defaultOptions,i);var n=this,a=n.find(".file-tab"),l=n.find(".panel-heading .btn:eq(0)"),o=a.find('input[type="file"]'),d=a.find(".btn:eq(1)"),s=n.find(".url-tab"),r=n.find(".panel-heading .btn:eq(1)"),g=s.find(".btn:eq(0)"),w=s.find(".btn:eq(1)");p(a),b(s),f(a),t.call(n),l.off(),o.off(),d.off(),r.off(),g.off(),w.off(),l.on("click",function(){e(this).blur(),f(a)}),o.on("change",function(){e(this).blur(),u(a),n.find('input[type="text"]').val("on")}),d.on("click",function(){e(this).blur(),p(a),n.find('input[type="text"]').val("on")}),r.on("click",function(){e(this).blur(),c(s)}),g.on("click",function(){e(this).blur(),m(s),n.find('input[type="text"]').val("on")}),w.on("click",function(){e(this).blur(),b(s)}),v.imageURL&&h(n,v.imageURL)}function n(){this.addClass("imageupload-disabled")}function t(){this.removeClass("imageupload-disabled")}function a(){var e=this;i.call(e,v)}function l(e){var i=[];return i.push('<div class="alert alert-danger alert-dismissible fade show" role="alert">'),i.push(e),i.push('<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>'),i.push("</div>"),i.join("")}function o(e){return'<img src="'+e+'" alt="Image preview" class="thumbnail" style="max-width: '+v.maxWidth+"px; max-height: "+v.maxHeight+'px">'}function d(e){return e.substr(e.lastIndexOf(".")+1).toLowerCase()}function s(i,n){if(i.size/1024>v.maxFileSizeKb)return void n(!1,"File is too large (max "+v.maxFileSizeKb+"kB).");var t=d(i.name);e.inArray(t,v.allowedFormats)>-1?n(!0,"Image file is valid."):n(!1,"File type is not allowed.")}function r(i,n){var t=null,a=!1,l=new Image;l.onload=function(){if(!a){window.clearTimeout(t);var l=i;-1!==l.indexOf("?")&&(l=l.split("?")[0].split("#")[0]);var o=d(l);e.inArray(o,v.allowedFormats)>-1?n(!0,"Image URL is valid."):n(!1,"File type is not allowed.")}},l.onerror=function(){a||(window.clearTimeout(t),n(!1,"Image could not be found."))},l.src=i,t=window.setTimeout(function(){a=!0,l.src="???",n(!1,"Loading image timed out.")},3e3)}function f(e){var i=e.closest(".imageupload"),n=i.find(".panel-heading .btn:eq(0)");if(!n.hasClass("active")){var t=i.find(".url-tab");i.find(".panel-heading .btn:eq(1)").removeClass("active"),n.addClass("active"),t.hide(),e.show(),b(t)}}function p(e){e.find(".alert").remove(),e.find("img").remove(),e.find(".btn span").text(v.labels.browse),e.find(".btn:eq(1)").hide(),e.find("input").val("")}function u(e){var i=e.find(".btn:eq(0)"),n=e.find(".btn:eq(1)"),t=i.find("input");if(e.find(".alert").remove(),e.find("img").remove(),i.find("span").text(v.labels.browse),n.hide(),t[0].files&&t[0].files[0]){i.prop("disabled",!0);var a=t[0].files[0];s(a,function(d,s){if(d){var r=new FileReader;r.onload=function(t){e.prepend(o(t.target.result)),i.find("span").text(v.labels.change),n.css("display","inline-block")},r.onerror=function(){e.prepend(l("Error loading image file.")),t.val("")},r.readAsDataURL(a)}else e.prepend(l(s)),i.find("span").text(v.labels.browse),t.val("");i.prop("disabled",!1)})}}function c(e){var i=e.closest(".imageupload"),n=i.find(".panel-heading .btn:eq(1)");if(!n.hasClass("active")){var t=i.find(".file-tab");i.find(".panel-heading .btn:eq(0)").removeClass("active"),n.addClass("active"),t.hide(),e.show(),p(t)}}function b(e){e.find(".alert").remove(),e.find("img").remove(),e.find(".btn:eq(1)").hide(),e.find("input").val("")}function m(i){var n=i.find('input[type="text"]'),t=i.find(".btn:eq(0)"),a=i.find(".btn:eq(1)");i.find(".alert").remove(),i.find("img").remove(),a.hide();var d=n.val();if(!d)return void i.prepend(l("Please enter an image URL."));n.prop("disabled",!0),t.prop("disabled",!0),r(d,function(s,r){s?(i.find('input[type="hidden"]').val(d),e(o(d)).insertAfter(t.closest(".input-group")),a.css("display","inline-block")):i.prepend(l(r)),n.prop("disabled",!1),t.prop("disabled",!1)})}function h(e,i){var n=e.find(".file-tab"),t=n.find(".btn:eq(0)"),a=n.find(".btn:eq(1)"),d=t.find("input"),s=new XMLHttpRequest;s.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){var e=new FileReader;e.onload=function(e){n.prepend(o(e.target.result))},e.readAsDataURL(this.response),t.find("span").text(v.labels.change),a.css("display","inline-block")}else n.prepend(l("Image could not be loaded")),t.find("span").text(v.labels.browse),d.val("")},s.open("GET",i),s.responseType="blob",s.send()}var v={},g={init:i,disable:n,enable:t,reset:a};e.fn.imageupload=function(i){var n=arguments;return this.filter("div").each(function(){if(g[i])g[i].apply(e(this),Array.prototype.slice.call(n,1));else{if("object"!=typeof i&&i)throw new Error('Method "'+i+'" is not defined for imageupload.');g.init.apply(e(this),n)}})},e.fn.imageupload.defaultOptions={allowedFormats:["jpg","jpeg","png","gif"],maxWidth:250,maxHeight:250,maxFileSizeKb:2048,imageURL:"",labels:{browse:"Browse",change:"Change"}}}(jQuery);